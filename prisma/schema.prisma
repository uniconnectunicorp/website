// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  role          Role      @default(user)
  finance       Finance[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]
  accounts      Account[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}


model Lead {
  id        String   @id
  name      String
  email     String?
  phone     String
  message   String?
  cpf       String?
  rg        String?
  birthDate String?
  address   String?
  houseNumber String?
  neighborhood String?
  city      String?
  state     String?
  zipCode   String?
  civilStatus String?
  course    String?
  status    LeadStatus @default(pending)
  notes     String?
  assignedTo String?
  source    String?
  campaign  String?
  utmSource String?
  utmMedium String?
  utmCampaign String?
  history   LeadHistory[]
  paymentMethod String?
  finance   Finance?
  lossReason String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("lead")
}

model LeadHistory {
  id        String   @id
  leadId    String
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  action    String
  createdAt DateTime @default(now())
  
  @@map("lead_history")
}

model Finance {
  id        String   @id
  leadId    String?  @unique
  lead      Lead?    @relation(fields: [leadId], references: [id], onDelete: Cascade)
  amount    Float
  installments Int?
  type      FinanceType
  description String?
  userId    String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  paymentMethod String?
  transactionDate DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("finance")
}


enum Role {
  user
  director
  finance
  seller
  manager
  admin
}

enum LeadStatus {
  pending
  contacted
  negociating
  confirmPayment
  converted
  lost
}

enum FinanceType {
  in
  out
  other
  leadPayment
}